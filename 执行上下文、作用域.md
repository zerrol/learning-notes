
### 执行上下文

js在执行一段代码时，会生成他的执行上下文。

执行上下文，又被称为执行环境，是在执行方法前的**编译**阶段创建的。

执行上下文可分为：

全局上下文：没有在函数体内的代码，往往是直接写在程序中的，例如全局的执行环境，`<script></script>`标签中的代码，或者引入的其他js文件等在执行时创建。

函数上下文：在执行函数`function`时创建

eval: eval内部的代码

> 这个时候如果是教材，是不是应该说，执行上下文是js执行一段代码的基本单位 23333


#### 执行上下文的组成

在es5前，执行上下文由作用域链、变量对象和`this`组成。

在es5后，引入了词法环境的概念，并且将变量对象更名为了变量环境。此时，执行上下文由作用域链、变量环境、词法环境和`this`组成。

在ECMA2018时，`this`被放入了变量环境，并且新增了`iterator`(用来标记这是一个迭代器)等新的内容。

#### 调用栈 (执行上下文栈)

调用栈，又称为执行上下文栈。在执行到一段代码时，js会将其`执行上下文`先推入调用栈中，函数执行结束后，将该函数的执行上下文从栈中推出。

### 变量环境

当一个函数在执行上下文生成后，代码执行前的编译阶段, 便会立即生成变量环境存放于执行上下文中。**es5之前变量环境被称为变量对象，后面改名为变量环境**


全局上下文的变量对象便是全局对象。而在浏览器中，我们所说的全局对象便是指向window，他是由`Object`的构造函数生成的实例，并且存放了许多像`Math`，`Array`等基础的对象。

函数上下文的变量对象又称为活动对象，他也是在编译阶段创建。

活动对象主要的作用是：
1: 存放函数体中用var关键字声明的变量，在编译时默认赋值为`undefined`。
2: 存放函数体中function关键字声明的方法，在编译时便会生成，如果与var声明的变量重名，则会覆盖掉var声明的变量。
3: 存放arguments

### 词法环境 (块级作用域)

在es6中引入，使用let、const定义的变量会被存放到词法环境的变量栈中。通过词法环境，js实现了块级作用域。

在词法环境中，存在一个存放变量的栈结构。当编译阶段遇到一个代码块时，便会生成一个环境推入这个**栈**中，并将所有
let、const声明的变量，初始化到这个环境里面。当这个代码块执行完毕之后，便会将这个环境从栈中推出。

当js在查找变量时，便会先经过词法环境的栈，再查询上下文中的变量环境。

### 作用域

在引入词法环境前，js中的作用域其实就是指的执行上下文中的变量对象。

变量环境有两种，全局执行上下文中的变量环境，又叫做全局作用域；函数执行上下文中的变量环境，又叫做函数作用域。

在引入词法环境之后，使用let、const定义的变量会被存放到词法环境的变量栈中。从而引入了块级作用域的概念。

#### 全局作用域

全局执行上下文的变量环境加上词法环境便是全局作用域。

在浏览器中，全局上下文的变量对象就是window。所以在js引入词法环境之前，可以说全局作用域就是window。这也是为什么在js中可以不用`window.Math`而可以直接使用`Math`。

#### 函数作用域

**函数作用域在函数定义时变决定了**

函数执行上下文中的作用域。同样由变量环境和词法环境组成。

#### 块级作用域

块级作用域在es6中被引入，通过let、const声明的变量便会被存放在块级作用域中。块级作用域其实被存放于